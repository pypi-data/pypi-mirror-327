"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[8268],{16204:function(e,t,n){n.d(t,{Z:function(){return b}});var r=n(26068),s=n.n(r),a=n(48305),l=n.n(a),o=n(67825),i=n.n(o),c=n(43943),u=n(23333),d=n(76808),f=n(32699),p=n(50959),m=n(38780),h=n(11527),g=function(e){var t=e.isOverflowing,n=e.showTitle,r=e.title,s=e.children,a=(0,m.Z)().initialize,l=p.useRef(null);return p.useEffect((function(){l.current&&a(l.current)}),[a,l.current]),(0,h.jsx)("div",{style:{maxHeight:200,overflowY:"auto"},ref:l,children:(0,h.jsx)("div",{style:{width:"max-content",maxWidth:250,paddingInline:10},children:t||n?r||s:""})})},v=p.memo(g),x=["children","maxWidth","minWidth","ghost","title","showTitle","tooltipProps"],y=function(e){var t=e.children,n=e.maxWidth,r=void 0===n?"100%":n,a=e.minWidth,o=e.ghost,m=void 0!==o&&o,g=e.title,y=e.showTitle,b=void 0!==y&&y,j=e.tooltipProps,k=i()(e,x),w=(0,p.useRef)(null),Z=(0,p.useState)(!1),C=l()(Z,2),S=C[0],M=C[1],_=(0,p.useCallback)((function(){if(w.current){var e=w.current,t=e.scrollWidth,n=e.clientWidth;M(t>n)}}),[w.current]);(0,p.useEffect)((function(){var e=w.current;if(e){var t=new ResizeObserver((function(){_()}));return t.observe(e),_(),function(){return t.disconnect()}}}),[_]),(0,p.useEffect)((function(){var e=(0,f.throttle)(_,200);return window.addEventListener("resize",e),function(){window.removeEventListener("resize",e),e.cancel()}}),[_]),(0,p.useEffect)((function(){_()}),[t,_]);var N=(0,p.useMemo)((function(){return s()({maxWidth:r,minWidth:a,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},k.style)}),[r,k.style]);return(0,h.jsx)(u.Z,s()(s()({overlayInnerStyle:{paddingInline:0},destroyTooltipOnHide:!1,title:S||b?(0,h.jsx)(v,{isOverflowing:S,title:g,showTitle:b,children:t}):""},j),{},{children:m?(0,h.jsx)("div",{ref:w,style:N,"data-overflow":S,children:t}):(0,h.jsx)(d.Z,s()(s()({},k),{},{ref:w,style:s()(s()({},N),{},{paddingInline:k.closable?"8px 22px":8,borderRadius:12}),closeIcon:!!k.closable&&(0,h.jsx)(c.Z,{style:{position:"absolute",right:8,top:8}}),children:t}))}))},b=p.memo(y)},46750:function(e,t,n){n.d(t,{Z:function(){return g}});var r=n(19289),s=n(87497),a=n(83603),l=n(48980),o=n(32699),i=n(23323),c=n(50959),u=n(43585),d=n(11527),f=s.Z.Text,p=s.Z.Link,m=s.Z.Paragraph,h=function(e){var t=e.content,n=e.generateImgLink,h=e.height,g=void 0===h?"auto":h,v=e.theme,x=void 0===v?"light":v,y=new i.TU.Renderer,b=i.TU.lexer(t),j=["code","link","hr","heading","paragraph","codespan","strong","text","image","em","list","list_item","br","html","escape","del","blockquote","checkbox"],k=(0,c.useCallback)((function(e){return/^(https?:\/\/|\/\/)([^\s/$.?#].[^\s]*)$/.test(e)}),[]),w=(0,c.useCallback)((function(e){return e?n?k(e)?e:n(e):e:""}),[n]),Z=(0,c.useCallback)((function(e,t){var n;if(!j.includes(e.type))return(0,d.jsx)("span",{dangerouslySetInnerHTML:{__html:i.TU.parser([e],{renderer:y})}});var c=null,h=null;null!==(n=e.tokens)&&void 0!==n&&n.length&&(h=null==t?void 0:t(e.tokens,t));var g=h||(0,o.unescape)(e.text);if("escape"===e.type&&(c=g),"html"===e.type&&(c=(0,d.jsx)("div",{dangerouslySetInnerHTML:{__html:e.text}})),"list"===e.type&&(c=e.order?(0,d.jsx)("ol",{children:null==t?void 0:t(e.items,t)}):(0,d.jsx)("ul",{children:null==t?void 0:t(e.items,t)})),"list_item"===e.type&&(c=(0,d.jsx)("li",{children:g})),"del"===e.type&&(c=(0,d.jsx)("del",{children:g})),"blockquote"===e.type&&(c=(0,d.jsx)("blockquote",{children:g})),"checkbox"===e.type&&(c=(0,d.jsx)(a.Z,{value:e.checked})),"br"===e.type&&(c=(0,d.jsx)("br",{})),"em"===e.type&&(c=(0,d.jsx)("em",{children:g})),"image"===e.type){var v=w(e.href);c=(0,d.jsx)(l.Z,{src:v,alt:e.text,preview:{mask:(0,d.jsx)(r.Z,{})}})}return"text"===e.type&&(c=g),"codespan"===e.type&&(c=(0,d.jsx)(f,{code:!0,children:g})),"strong"===e.type&&(c=(0,d.jsx)(f,{strong:!0,children:g})),"heading"===e.type&&(c=(0,d.jsx)(s.Z.Title,{level:4,children:g})),"paragraph"===e.type&&(c=(0,d.jsxs)(m,{children:[" ",g]})),"code"===e.type&&(c=(0,d.jsx)(u.Z,{theme:x,code:e.text,lang:e.lang})),"link"===e.type&&(c=(0,d.jsx)(p,{href:e.href,title:e.title||"",target:"_blank",rel:"noopener noreferrer",children:g})),"hr"===e.type&&(c=(0,d.jsx)("hr",{className:"hr"})),c}),[w]);return(0,c.useEffect)((function(){t&&document.querySelectorAll(".markdown-viewer img").forEach((function(e){var t=e.getAttribute("src");e.setAttribute("src",w(t))}))}),[t,w]),(0,d.jsx)(d.Fragment,{children:(0,d.jsx)("div",{style:{height:g},className:"markdown-viewer custom-scrollbar-horizontal",children:function e(t){return null==t?void 0:t.map((function(t,n){return(0,d.jsx)(c.Fragment,{children:Z(t,e)},n)}))}(b)})})},g=c.memo(h)},37175:function(e,t,n){n.r(t),n.d(t,{default:function(){return it}});var r=n(90228),s=n.n(r),a=n(87999),l=n.n(a),o=n(48305),i=n.n(o),c=n(49280),u=n(37963),d=n(82344),f=n(69997),p=n(57989),m=n(92067),h=n(63830),g=n(67581),v=n(35374),x=n(54235),y=n(85885),b=n(96938),j=n(47946),k=n(82187),w=n.n(k),Z=n(32699),C=n.n(Z),S=n(50959),M=n(94299),_=n(91082),N=n(26068),I=n.n(N),R=n(15558),P=n.n(R),T=n(38780),O=n(69510),A=n(54876),E=(n(99951),n(1731)),F=(n(29031),n(76223),n(19427)),z=(n(64818),n(63417)),L=n(62640),D=n(41466),U=n(81e3),G=n(23333),W=n(76574),V=n(11527),q=(L.Z,D.Z,function(e){var t=e.actions,n=e.data,r=(e.renderMode,e.renderModeChange,e.updateMessage),s=e.onDelete,a=(0,v.useIntl)(),l=(0,S.useCallback)((function(e){null==r||r({role:n.role,content:n.content,uid:n.uid,imgs:[].concat(P()(n.imgs||[]),P()(e))})}),[n,r]);return(0,V.jsx)(V.Fragment,{children:t.length>1?(0,V.jsxs)("div",{className:"actions",children:[t.includes("upload")&&n.role===E.G7.User&&(0,V.jsx)(W.Z,{handleUpdateImgList:l}),n.content&&t.includes("copy")&&(0,V.jsx)(z.Z,{text:n.content,size:"small",shape:"default",type:"text",fontSize:"12px"}),t.includes("delete")&&(0,V.jsx)(G.Z,{title:a.formatMessage({id:"common.button.delete"}),children:(0,V.jsx)(y.ZP,{size:"small",type:"text",onClick:s,icon:(0,V.jsx)(U.Z,{})})})]}):null})}),B=n(46750),H=n(8267),K=n(42326),J=n(16407),Y=function(e){var t=e.content,n=(0,v.useIntl)(),r=(0,S.useState)(!1),s=i()(r,2),a=s[0],l=s[1];return(0,V.jsx)(V.Fragment,{children:t?(0,V.jsxs)("div",{className:"think-wrapper",children:[(0,V.jsx)("div",{className:"btn-collapse",children:(0,V.jsxs)(y.ZP,{size:"small",type:"text",className:"flex-center",variant:a?"filled":void 0,color:"default",onClick:function(){return l(!a)},children:[(0,V.jsx)(c.Z,{type:"icon-AIzhineng"}),(0,V.jsx)("span",{children:n.formatMessage({id:"playground.chat.aithought"})}),(0,V.jsx)(J.Z,{rotate:a?0:180,className:"m-l-10"})]})}),!a&&(0,V.jsx)("div",{className:"think-content",children:t})]}):null})},$=n(25298),Q=n.n($),X=n(17069),ee=n.n(X),te=n(82092),ne=n.n(te),re=function(){function e(){Q()(this,e),ne()(this,"lastCheckedIndex",void 0),ne()(this,"collecting",void 0),ne()(this,"thought",void 0),ne()(this,"result",void 0),this.thought="",this.result="",this.collecting=!1,this.lastCheckedIndex=0}return ee()(e,[{key:"parse",value:function(e){for(;this.lastCheckedIndex<e.length;){var t=e.indexOf("<think>",this.lastCheckedIndex),n=e.indexOf("</think>",this.lastCheckedIndex);this.collecting?-1!==n?(this.thought+=e.substring(this.lastCheckedIndex,n),this.collecting=!1,this.lastCheckedIndex=n+8):(this.thought+=e.substring(this.lastCheckedIndex),this.lastCheckedIndex=e.length):-1!==n&&(-1===t||n<t)?(this.thought=this.result+e.substring(this.lastCheckedIndex,n),this.result="",this.lastCheckedIndex=n+8):-1!==t?(this.result+=e.substring(this.lastCheckedIndex,t),this.collecting=!0,this.lastCheckedIndex=t+7):(this.result+=e.substring(this.lastCheckedIndex),this.lastCheckedIndex=e.length)}return{thought:this.thought.trim(),result:this.result}}},{key:"reset",value:function(){this.thought="",this.result="",this.collecting=!1,this.lastCheckedIndex=0}}]),e}(),se=function(e){var t,n,r=e.editable,a=e.data,o=e.loading,i=e.actions,c=e.updateMessage,u=(0,S.useRef)(null),d=(0,S.useRef)(0),f=(0,S.useRef)(null),p=(0,S.useMemo)((function(){return!f.current&&null!=i&&i.includes("markdown")&&(f.current=new re),null!=i&&i.includes("markdown")?f.current.parse(a.content):{thought:"",result:a.content}}),[a.content,i]),m=(0,S.useCallback)(function(){var e=l()(s()().mark((function e(t){var n,r,l,o,i,u,f;return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.clipboardData||window.clipboardData,r=n.items,l=[],o=s()().mark((function e(){var t,n,a;return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:"file"===(t=r[i]).kind&&-1!==t.type.indexOf("image")?(n=t.getAsFile(),a=new Promise((function(e,t){var r=new FileReader;r.onload=function(n){var r,s=null===(r=n.target)||void 0===r?void 0:r.result;s?e(s):t("Failed to convert image to base64")},r.readAsDataURL(n)})),l.push(a)):t.kind;case 2:case"end":return e.stop()}}),e)})),i=0;case 5:if(!(i<r.length)){e.next=10;break}return e.delegateYield(o(),"t0",7);case 7:i++,e.next=5;break;case 10:return e.prev=10,e.next=13,Promise.all(l);case 13:(u=e.sent).length&&(f=C().map(u,(function(e){return d.current+=1,{uid:d.current,dataUrl:e}})),null==c||c({role:a.role,content:a.content,uid:a.uid,imgs:[].concat(P()(a.imgs||[]),P()(f))})),e.next=20;break;case 17:e.prev=17,e.t1=e.catch(10);case 20:case"end":return e.stop()}}),e,null,[[10,17]])})));return function(t){return e.apply(this,arguments)}}(),[a,c]),h=function(e){e.clipboardData.getData("text")||(e.preventDefault(),m(e))},g=function(e){var t=C().filter(a.imgs,(function(t){return t.uid!==e}));null==c||c({role:a.role,content:a.content,uid:a.uid,imgs:t})},v=function(e){var t;(null==c||c({imgs:a.imgs||[],role:a.role,content:e.target.value,uid:a.uid}),a.role===E.G7.Assistant)&&(null===(t=f.current)||void 0===t||t.reset())},x=(0,S.useCallback)((function(){var e;if(a.imgs&&(null===(e=a.imgs)||void 0===e?void 0:e.length)>0){var t=P()(a.imgs||[]).pop();t&&g(t.uid)}}),[a.imgs,g]),y=(0,S.useCallback)((function(e){var t;"Backspace"===e.key&&""===a.content&&a.imgs&&(null===(t=a.imgs)||void 0===t?void 0:t.length)>0&&(e.preventDefault(),x())}),[a,x]);return r?(0,V.jsxs)("div",{className:w()("message-content-input",{"has-img":null===(t=a.imgs)||void 0===t?void 0:t.length}),onClick:function(e){var t;e.stopPropagation(),e.preventDefault(),null===(t=u.current)||void 0===t||t.focus()},children:[(0,V.jsx)(K.Z,{editable:r,dataList:a.imgs||[],onDelete:g}),(0,V.jsx)(V.Fragment,{children:a.role===E.G7.User?(0,V.jsx)(H.Z.TextArea,{ref:u,value:a.content,variant:"filled",autoSize:{minRows:1},style:{borderRadius:"var(--border-radius-mini)"},readOnly:o,onKeyDown:y,onChange:v,onPaste:h}):(0,V.jsx)(V.Fragment,{children:null!=i&&i.includes("markdown")?(0,V.jsxs)(V.Fragment,{children:[(0,V.jsx)(Y,{content:p.thought}),(0,V.jsx)("div",{style:{paddingInline:4},children:(0,V.jsx)(B.Z,{content:p.result||"",theme:"light"})})]}):(0,V.jsx)(H.Z.TextArea,{ref:u,value:a.content,variant:"filled",autoSize:{minRows:1},style:{borderRadius:"var(--border-radius-mini)"},readOnly:o,onKeyDown:y,onChange:v,onPaste:h})})})]}):(0,V.jsxs)("div",{className:w()("content-item-content",{"has-img":null===(n=a.imgs)||void 0===n?void 0:n.length}),children:[(0,V.jsx)(K.Z,{editable:r,dataList:a.imgs||[],onDelete:g}),a.content&&(0,V.jsx)("div",{className:"text",children:a.content})]})},ae=function(e){var t,n=e.updateMessage,r=e.onDelete,s=e.loading,a=e.data,l=e.editable,o=e.showTitle,i=void 0===o||o,c=e.actions,u=void 0===c?["upload","delete","copy"]:c,d=(0,v.useIntl)();return(0,V.jsxs)("div",{className:"content-item",children:[(0,V.jsxs)("div",{className:"content-item-role",style:{display:i||u.length?"flex":"none"},children:[i&&(0,V.jsx)("div",{className:"role",children:null!==(t=a.title)&&void 0!==t?t:d.formatMessage({id:"playground.".concat(a.role)})}),(0,V.jsx)(q,{data:a,actions:u,onDelete:r,updateMessage:n})]}),(0,V.jsx)(se,{editable:l,data:a,loading:s,actions:u,updateMessage:n})]})},le=S.memo(ae),oe=function(e){var t=e.setMessageList,n=e.messageList,r=e.editable,s=e.showTitle,a=void 0===s||s,l=e.actions,o=void 0===l?["upload","delete","copy"]:l;return(0,V.jsx)(V.Fragment,{children:!!n.length&&(0,V.jsx)("div",{className:"message-content-list",children:n.map((function(e,s){return(0,V.jsx)(le,{data:e,editable:r,actions:o,showTitle:a,onDelete:function(){return function(e){var r=P()(n);r.splice(e,1),null==t||t(r)}(s)},updateMessage:function(e){return function(e,r){var s=P()(n);s[e]=r,null==t||t(s)}(s,e)}},e.uid)}))})})},ie=S.memo(oe),ce=n(43943),ue=n(83603),de=n(76571),fe=function(e){var t=e.systemMessage,n=e.showApplyToAll,r=e.setSystemMessage,s=e.style,a=e.applyToAll,l=(0,v.useIntl)(),o=(0,S.useState)(!1),c=i()(o,2),u=c[0],d=c[1],f=S.useRef(null),p=(0,S.useState)({minRows:1,maxRows:1,focus:!1}),m=i()(p,2),h=m[0],g=m[1],x=function(){g({minRows:4,maxRows:4,focus:!0}),setTimeout((function(){var e,t;null===(e=f.current)||void 0===e||null===(t=e.focus)||void 0===t||t.call(e,{cursor:"end"})}),100)};return(0,S.useEffect)((function(){u&&(null==a||a(t))}),[u]),(0,V.jsxs)("div",{className:w()("sys-message",{focus:h.focus}),style:I()({},s),children:[(0,V.jsxs)("div",{style:{display:h.focus?"block":"none"},className:"textarea-wrapper",children:[(0,V.jsx)("span",{className:"system-label",children:l.formatMessage({id:"playground.systemMessage"})}),(0,V.jsx)(H.Z.TextArea,{className:"custome-scrollbar",ref:f,variant:"filled",placeholder:l.formatMessage({id:"playground.system.tips"}),style:{borderRadius:"0",border:"none"},value:t,autoSize:{minRows:h.minRows,maxRows:h.maxRows},onFocus:x,onBlur:function(e){g({minRows:1,maxRows:1,focus:!1})},allowClear:!1,onChange:function(e){r(e.target.value),u&&(null==a||a(e.target.value))}}),n&&(0,V.jsxs)("span",{className:"apply-check",onMouseDown:function(e){e.preventDefault(),d(!u)},children:[(0,V.jsx)("span",{className:"m-r-5",children:l.formatMessage({id:"playground.compare.applytoall"})}),(0,V.jsx)(ue.Z,{checked:u})]}),(0,V.jsx)(de.Z,{style:{margin:"0"}})]}),!h.focus&&(0,V.jsxs)("div",{className:"sys-content-wrap",onClick:x,children:[(0,V.jsxs)("div",{className:"sys-content",children:[(0,V.jsx)("span",{className:"title",children:l.formatMessage({id:"playground.systemMessage"})}),t||(0,V.jsx)("span",{style:{color:"var(--ant-color-text-tertiary)"},children:l.formatMessage({id:"playground.system.tips"})})]}),t&&(0,V.jsx)(G.Z,{title:l.formatMessage({id:"common.button.clear"}),children:(0,V.jsx)(y.ZP,{className:"clear-btn",type:"text",icon:(0,V.jsx)(ce.Z,{}),size:"small",onClick:function(){r("")}})})]})]})},pe=S.memo(fe),me=n(1436),he=n(39139),ge=n(55825),ve=n(66389),xe=n(34155),ye=n(68476),be=n(40474),je=n(96247),ke=n(35897),we={seed:"seed",stop:"stop",temperature:"temperature",top_p:"top_p",n_ctx:"n_ctx",n_slot:"n_slot",max_model_len:"max_model_len"},Ze=function(e){var t=e.selectedModel,n=e.setParams,r=e.globalParams,s=e.onValuesChange,a=e.modelList,l=e.showModelSelector,o=void 0===l||l,c=(0,v.useIntl)(),u=I()({seed:null,stop:null,temperature:1,top_p:1,max_tokens:1024},r),d=ye.Z.useForm(),f=i()(d,1)[0],p=(0,S.useId)(),m=(0,S.useState)({}),h=i()(m,2),g=h[0],x=h[1],y=(0,S.useState)(!0),b=i()(y,2),j=b[0],k=b[1],w=(0,S.useCallback)((function(e,t){null==n||n(t),null==s||s(e,t)}),[s,n]),Z=(0,S.useCallback)((function(e,t){var r=f.getFieldsValue();f.setFieldsValue(I()(I()({},r),{},ne()({},t,e))),n(I()(I()({},r),{},ne()({},t,e))),null==s||s(ne()({},t,e),I()(I()({},r),{},ne()({},t,e)))}),[f,n,s]),M=function(e){var t=C().find(a,{value:e}),n=(null==t?void 0:t.meta)||{},r=C().pick(n,C().keys(we)),s=Object.entries(we).reduce((function(e,t){var n=i()(t,2),s=n[0],a=n[1],l=r[s];return l&&C().hasIn(r,s)&&(e[a]=l),e}),{}),l=1024;return s.n_ctx&&s.n_slot?l=C().divide(s.n_ctx/2,s.n_slot):s.max_model_len&&(l=s.max_model_len/2),f.setFieldsValue(I()(I()({},C().omit(s,["n_ctx","n_slot","max_model_len"])),{},{max_tokens:l})),x(I()(I()({},s),{},{max_tokens:s.max_model_len||C().divide(s.n_ctx,s.n_slot)})),I()(I()({},C().omit(s,["n_ctx","n_slot","max_model_len"])),{},{max_tokens:l})};(0,S.useEffect)((function(){var e=t||"";o&&(e=e||C().get(a,"[0].value"));var r=M(e),s=C().merge({},u,r);f.setFieldsValue(I()(I()({},s),{},{model:e})),n(I()(I()({},s),{},{model:e})),k(!1)}),[a,o,t]),(0,S.useEffect)((function(){j||f.setFieldsValue(r)}),[r,j]);var _=function(e){return(0,V.jsxs)("span",{className:ke.Z.label,style:{width:ve.d.mini},children:[(0,V.jsx)("span",{className:"text",children:e.description?(0,V.jsxs)(G.Z,{title:e.description,children:[(0,V.jsxs)("span",{children:[" ",e.label]}),(0,V.jsx)("span",{className:"m-l-5",children:(0,V.jsx)(xe.Z,{})})]}):(0,V.jsx)("span",{children:e.label})}),(0,V.jsx)(be.Z,{className:"label-val",variant:"outlined",size:"small",value:f.getFieldValue(e.field),controls:!1,onChange:function(t){return Z(t,e.field)}})]})};return(0,V.jsx)(ye.Z,{name:p,form:f,onValuesChange:w,onFinish:function(e){},onFinishFailed:function(e){},children:(0,V.jsxs)("div",{children:[o&&(0,V.jsxs)(V.Fragment,{children:[(0,V.jsx)("h3",{className:"m-b-20 m-l-10 font-size-14 line-24",children:c.formatMessage({id:"playground.model"})}),(0,V.jsx)(ye.Z.Item,{name:"model",rules:[{required:!0,message:c.formatMessage({id:"common.form.rule.select"},{name:c.formatMessage({id:"playground.model"})})}],children:(0,V.jsx)(ge.Z,{showSearch:!0,options:a,onChange:M})})]}),(0,V.jsx)("h3",{className:"m-b-20 m-l-10 flex-between flex-center font-size-14 line-24",children:(0,V.jsx)("span",{children:c.formatMessage({id:"playground.parameters"})})}),(0,V.jsx)(ye.Z.Item,{name:"temperature",rules:[{required:!1}],children:(0,V.jsx)(me.Z,{label:_({field:"temperature",label:"Temperature",description:c.formatMessage({id:"playground.params.temperature.tips"})}),style:{padding:"20px 2px 0"},variant:"borderless",children:(0,V.jsx)(je.Z,{defaultValue:1,max:2,step:.1,style:{marginBottom:0,marginTop:16,marginInline:0},tooltip:{open:!1},value:f.getFieldValue("temperature")||void 0,onChange:function(e){return Z(e,"temperature")}})})}),(0,V.jsx)(ye.Z.Item,{name:"max_tokens",rules:[{required:!1}],children:(0,V.jsx)(me.Z,{label:_({field:"max_tokens",label:"Max Tokens",description:c.formatMessage({id:"playground.params.maxtokens.tips"})}),style:{padding:"20px 2px 0"},variant:"borderless",children:(0,V.jsx)(je.Z,{defaultValue:2048,max:g.max_tokens||16384,step:1,style:{marginBottom:0,marginTop:16,marginInline:0},tooltip:{open:!1},value:f.getFieldValue("max_tokens")||void 0,onChange:function(e){return Z(e,"max_tokens")}})})}),(0,V.jsx)(ye.Z.Item,{name:"top_p",rules:[{required:!1}],children:(0,V.jsx)(me.Z,{label:_({field:"top_p",label:"Top P",description:c.formatMessage({id:"playground.params.topp.tips"})}),style:{padding:"20px 2px 0"},variant:"borderless",children:(0,V.jsx)(je.Z,{defaultValue:1,max:1,step:.1,style:{marginBottom:0,marginTop:16,marginInline:0},tooltip:{open:!1},value:f.getFieldValue("top_p")||void 0,onChange:function(e){return Z(e,"top_p")}})})}),(0,V.jsx)(ye.Z.Item,{name:"seed",rules:[{required:!1}],children:(0,V.jsx)(he.Z.Number,{label:"Seed",min:0,description:c.formatMessage({id:"playground.params.seed.tips"}),style:{width:ve.d.mini}})}),(0,V.jsx)(ye.Z.Item,{name:"stop",rules:[{required:!1}],normalize:function(e){return e||null},children:(0,V.jsx)(he.Z.Input,{allowClear:!0,label:"Stop Sequence",description:c.formatMessage({id:"playground.params.stop.tips"}),style:{width:ve.d.mini}})})]})})},Ce=(0,S.memo)(Ze),Se=n(78093),Me=n(87497),_e=function(e){var t=(0,v.useIntl)(),n=e.usage,r=e.showOutput,s=void 0===r||r,a=e.scaleable,l=e.fields,o=void 0===l?["completion_tokens","prompt_tokens"]:l;return!n||C().isEmpty(n)?null:n.error?(0,V.jsxs)(Me.Z.Paragraph,{type:"danger",ellipsis:{rows:2,tooltip:null==n?void 0:n.errorMessage},style:{textAlign:"center",paddingBlock:0,margin:0,backgroundColor:"var(--ant-color-error-bg)"},children:[(0,V.jsx)(Se.Z,{className:"m-r-8"}),null==n?void 0:n.errorMessage]}):(0,V.jsxs)("div",{className:w()("reference-params",{scaleable:a}),children:[(0,V.jsx)("span",{className:w()("usage",{scaleable:a}),children:(0,V.jsx)(G.Z,{title:(0,V.jsxs)(x.Z,{children:[o.includes("completion_tokens")&&(0,V.jsxs)("span",{children:[t.formatMessage({id:"playground.completion"}),":"," ",n.completion_tokens]}),o.includes("prompt_tokens")&&(0,V.jsxs)("span",{children:[t.formatMessage({id:"playground.prompt"}),":"," ",n.prompt_tokens]})]}),children:(0,V.jsxs)("span",{children:[t.formatMessage({id:"playground.tokenusage"}),":"," ",n.total_tokens]})})}),s&&(0,V.jsx)("span",{className:w()("usage",{scaleable:a}),children:(0,V.jsx)(G.Z,{title:(0,V.jsxs)(x.Z,{children:[(0,V.jsxs)("span",{children:["TPOT: ",C().round(n.time_per_output_token_ms,2)||0," ms"]}),(0,V.jsxs)("span",{children:["TTFT: ",C().round(n.time_to_first_token_ms,2)||0," ms"]})]}),children:(0,V.jsxs)("span",{children:[t.formatMessage({id:"playground.tokenoutput"}),":"," ",C().round(n.tokens_per_second,2)||0," Tokens/s"]})})})]})},Ne=n(31759),Ie=n.n(Ne),Re=n(37616),Pe=n(43585),Te=n(90515),Oe=n(1956),Ae="bash",Ee="python",Fe="javascript",ze=[{label:"Curl",value:Ae},{label:"Python",value:Ee},{label:"Nodejs",value:Fe}],Le=function(e){var t=e||{},n=t.title,r=t.open,s=t.api,a=t.clientType,l=t.logcommand,o=t.onCancel,c=t.payload,u=t.parameters,d=void 0===u?{}:u,f=(0,v.useIntl)(),p=(0,S.useState)(Ae),m=i()(p,2),h=m[0],g=m[1],x="".concat(window.location.origin,"/v1-openai"),b=(0,S.useMemo)((function(){var e=l?"console.log(response.".concat(l,");\n"):"",t=l?"print(response.".concat(l,")"):"";if(h===Ae)return"curl ".concat(window.location.origin,"/v1-openai/").concat(s,' \\\n-H "Content-Type: application/json" \\\n-H "Authorization: Bearer ${YOUR_GPUSTACK_API_KEY}" \\\n-d \'').concat(JSON.stringify(I()(I()({},d),c),null,2),"'");if(h===Fe)return'const OpenAI = require("openai");\n\nconst openai = new OpenAI({\n  "apiKey": "YOUR_GPUSTACK_API_KEY",\n  "baseURL": "'.concat(x,'"\n});\n\nasync function main(){\n  const params = ').concat(JSON.stringify(I()(I()({},d),c),null,4),";\nconst response = await openai.").concat(a,"(params);\n  ").concat(e,"}\nmain();");if(h===Ee){var n=C().keys(d).reduce((function(e,t){if(null===d[t])return e;var n="string"==typeof d[t]?'"'.concat(d[t],'"'):d[t];return e+"  ".concat(t,"=").concat(n,",\n")}),""),r=function(e){return C().keys(e).reduce((function(t,n){if(null===e[n])return t;var r="object"===Ie()(e[n])?JSON.stringify(e[n],null,2):'"'.concat(e[n],'"');return t+"  ".concat(n,"=").concat(r,",\n")}),"")}(c);return'from openai import OpenAI\n\nclient = OpenAI(\n  base_url="'.concat(x,'", \n  api_key="YOUR_GPUSTACK_API_KEY"\n)\n\nresponse = client.').concat(a,"(\n").concat(n).concat(r,")\n").concat(t)}return""}),[h,c,d,s,a,l]);return(0,V.jsx)(V.Fragment,{children:(0,V.jsxs)(Oe.Z,{title:n,open:r,centered:!0,onCancel:function(){g(Ae),o()},destroyOnClose:!0,closeIcon:!0,maskClosable:!1,keyboard:!1,width:600,footer:null,children:[(0,V.jsx)("div",{style:{marginBottom:"10px"},children:f.formatMessage({id:"playground.viewcode.info"})}),(0,V.jsxs)("div",{children:[(0,V.jsx)(Re.Z,{copyText:b,langOptions:ze,defaultValue:Ae,showHeader:!0,onChangeLang:function(e){g(e)},styles:{wrapper:{backgroundColor:"var(--color-editor-dark)"}},children:(0,V.jsx)("div",{style:{paddingRight:2,paddingBottom:2},children:(0,V.jsx)(Pe.Z,{height:380,theme:"dark",code:b,lang:h,copyable:!1})})}),(0,V.jsxs)("div",{style:{marginTop:10,display:"flex",alignItems:"baseline"},children:[(0,V.jsx)(Te.Z,{className:"m-r-8"}),(0,V.jsx)("span",{children:f.formatMessage({id:"playground.viewcode.tips"},{here:(0,V.jsx)(y.ZP,{type:"link",size:"small",href:"#/api-keys",target:"_blank",style:{paddingInline:2},children:(0,V.jsxs)("span",{children:[" ",f.formatMessage({id:"playground.viewcode.here"})]})})})})]})]})]})})},De=S.memo(Le),Ue=(0,S.forwardRef)((function(e,t){var n=e.modelList,r=(0,S.useRef)(0),a=(0,S.useState)([]),o=i()(a,2),c=o[0],u=o[1],d=(0,v.useIntl)(),f=(0,v.useSearchParams)(),p=i()(f,1)[0].get("model")||"",m=(0,S.useState)({}),h=i()(m,2),g=h[0],x=h[1],y=(0,S.useState)(""),b=i()(y,2),j=b[0],k=b[1],Z=(0,S.useState)(!1),M=i()(Z,2),N=M[0],R=M[1],z=(0,S.useState)(!1),L=i()(z,2),D=L[0],U=L[1],G=(0,S.useState)(null),W=i()(G,2),q=W[0],B=W[1],H=(0,S.useState)(!1),K=i()(H,2),J=K[0],Y=K[1],$=(0,S.useRef)(""),Q=(0,S.useRef)(null),X=(0,S.useRef)(null),ee=(0,S.useRef)(null),te=(0,S.useRef)(null),ne=(0,S.useRef)(0),re=(0,S.useRef)(""),se=(0,S.useState)(["upload","delete","copy"]),ae=i()(se,2),le=ae[0],oe=ae[1],ce=(0,T.Z)(),ue=ce.initialize,de=ce.updateScrollerPosition,fe=(0,T.Z)().initialize;(0,S.useImperativeHandle)(t,(function(){return{viewCode:function(){R(!0)},setCollapse:function(){Y(!J)},collapse:J}}));var me=(0,S.useMemo)((function(){return(0,E.kA)([{role:E.G7.System,content:j}].concat(P()(c)))}),[c,j]),he=function(){r.current=r.current+1},ge=function(e){var t;if(B(I()({},null!==(t=null==e?void 0:e.usage)&&void 0!==t?t:{})),e&&C().get(e,"choices",[]).length){re.current=re.current+C().get(e,"choices.0.delta.reasoning_content",""),$.current=$.current+C().get(e,"choices.0.delta.content","");var n,s=(n={content:$.current,reasoningContent:re.current}).reasoningContent&&!n.content?"<think>".concat(n.reasoningContent):n.reasoningContent&&n.content?"<think>".concat(n.reasoningContent,"</think>").concat(n.content):n.content;u([].concat(P()(c),P()(ee.current),[{role:E.G7.Assistant,content:s,uid:r.current}]))}},ve=function(){var e=l()(s()().mark((function e(t){var n,a,l,o,i,d,f,p,m,h,v;return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(g.model){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,U(!0),he(),B(null),null===(n=Q.current)||void 0===n||null===(a=n.abort)||void 0===a||a.call(n),Q.current=new AbortController,l=Q.current.signal,ee.current=t?[I()(I()({},t),{},{uid:r.current})]:[],$.current="",re.current="",u((function(e){return[].concat(P()(e),P()(ee.current))})),o=[{role:E.G7.System,content:j}].concat(P()(c),P()(ee.current)),i=(0,E.kA)(o),d=I()(I()({messages:i},g),{},{stream:!0,stream_options:{include_usage:!0}}),e.next=18,(0,O.U3)({data:d,url:_.qt,signal:l});case 18:if(null==(f=e.sent)||!f.error){e.next=22;break}return B({error:!0,errorMessage:(null==f||null===(p=f.data)||void 0===p||null===(p=p.error)||void 0===p?void 0:p.message)||(null==f||null===(m=f.data)||void 0===m?void 0:m.message)||""}),e.abrupt("return");case 22:return he(),h=f.reader,v=f.decoder,e.next=26,(0,O.LN)(h,v,(function(e){var t;null!=e&&e.error?B({error:!0,errorMessage:(null==e||null===(t=e.error)||void 0===t?void 0:t.message)||(null==e?void 0:e.message)||""}):ge(e)}));case 26:e.next=31;break;case 28:e.prev=28,e.t0=e.catch(2);case 31:return e.prev=31,U(!1),e.finish(31);case 34:case"end":return e.stop()}}),e,null,[[2,28,31,34]])})));return function(t){return e.apply(this,arguments)}}();C().throttle(de,100);return(0,S.useEffect)((function(){X.current&&ue(X.current)}),[X.current,ue]),(0,S.useEffect)((function(){te.current&&fe(te.current)}),[te.current,fe]),(0,S.useEffect)((function(){D&&de()}),[c,D]),(0,S.useEffect)((function(){c.length>ne.current&&de(),ne.current=c.length}),[c.length]),(0,V.jsxs)("div",{className:"ground-left-wrapper",children:[(0,V.jsxs)("div",{className:"ground-left",children:[(0,V.jsx)("div",{className:"message-list-wrap",ref:X,children:(0,V.jsxs)(V.Fragment,{children:[(0,V.jsx)("div",{style:{marginBottom:20},children:(0,V.jsx)(pe,{style:{borderRadius:"var(--border-radius-mini)",overflow:"hidden"},systemMessage:j,setSystemMessage:k})}),(0,V.jsxs)("div",{className:"content",children:[(0,V.jsx)(ie,{messageList:c,setMessageList:u,editable:!0,loading:D,actions:le}),D&&(0,V.jsx)(A.Z,{size:"small",children:(0,V.jsx)("div",{style:{height:"46px"}})})]})]})}),q&&(0,V.jsx)("div",{style:{height:40},children:(0,V.jsx)(_e,{usage:q})}),(0,V.jsx)("div",{className:"ground-left-footer",children:(0,V.jsx)(F.Z,{defaultSize:{minRows:5,maxRows:5},actions:["clear","layout","role","upload","add","paste","check"],defaultChecked:!1,checkLabel:"Markdown",onCheck:function(e){var t=e.target.checked;oe(t?["upload","delete","copy","markdown"]:["upload","delete","copy"])},loading:D,disabled:!g.model,isEmpty:!c.length,handleSubmit:function(e){var t,n=e.content||null!==(t=e.imgs)&&void 0!==t&&t.length?e:void 0;ve(n)},addMessage:function(e){var t,n=e||{role:(null===(t=C().last(c))||void 0===t?void 0:t.role)===E.G7.User?E.G7.Assistant:E.G7.User,content:""};c.push(I()(I()({},n),{},{uid:r.current+1})),he(),u(P()(c))},handleAbortFetch:function(){var e,t;null===(e=Q.current)||void 0===e||null===(t=e.abort)||void 0===t||t.call(e),U(!1)},clearAll:function(){c.length&&(he(),u([]),B(null))},setModelSelections:function(){},presetPrompt:function(e){var t,n=e.filter((function(e){return"system"===e.role})),s=e.filter((function(e){return"user"===e.role})).map((function(e){return he(),I()(I()({},e),{},{uid:r.current})}));k((null===(t=n[0])||void 0===t?void 0:t.content)||""),u(s)}})})]}),(0,V.jsx)("div",{className:w()("params-wrapper",{collapsed:J}),ref:te,children:(0,V.jsx)("div",{className:"box",children:(0,V.jsx)(Ce,{setParams:x,params:g,selectedModel:p,modelList:n})})}),(0,V.jsx)(De,I()(I()({},E.NW.chat),{},{open:N,payload:{messages:me},parameters:g,onCancel:function(){R(!1)},title:d.formatMessage({id:"playground.viewcode"})}))]})})),Ge=(0,S.memo)(Ue),We=S.createContext({}),Ve=n(23010),qe=function(e){var t=e.style,n=(0,v.useIntl)();(0,v.useNavigate)();return(0,V.jsx)("div",{className:"flex-center  justify-center",style:I()({},t),children:(0,V.jsx)(Ve.Z,{image:Ve.Z.PRESENTED_IMAGE_SIMPLE,description:(0,V.jsx)("div",{className:"flex-column",children:(0,V.jsx)(Me.Z.Text,{type:"secondary",children:n.formatMessage({id:"playground.model.noavailable"})})})})})},Be=n(81745),He=n(7922),Ke=n(16204),Je=n(51076),Ye=n(69070),$e=n(1404),Qe=n(43211),Xe=n(60857),et=n(8964),tt=n(40918),nt=(0,S.forwardRef)((function(e,t){var n=e.model,r=e.modelList,a=e.instanceId,o=(0,S.useContext)(We),u=o.globalParams,d=o.setGlobalParams,f=o.setLoadingStatus,p=o.handleDeleteModel,m=o.handleApplySystemChangeToAll,h=o.modelFullList,g=o.loadingStatus,x=o.actions,b=(0,v.useIntl)(),j=(0,S.useRef)(!1),k=(0,S.useState)(""),w=i()(k,2),Z=w[0],M=w[1],N=(0,S.useState)({model:n}),R=i()(N,2),F=R[0],z=R[1],L=(0,S.useState)(!1),D=i()(L,2),U=D[0],G=(D[1],(0,S.useRef)(0)),W=(0,S.useState)([]),q=i()(W,2),B=q[0],H=q[1],K=(0,S.useState)(null),J=i()(K,2),Y=J[0],$=J[1],Q=(0,S.useState)(!1),X=i()(Q,2),ee=X[0],te=X[1],ne=(0,S.useRef)(""),re=(0,S.useRef)(null),se=(0,S.useRef)([]),ae=(0,S.useRef)(null),le=(0,S.useRef)(0),oe=(0,S.useRef)(""),ce=(0,T.Z)(),de=ce.initialize,fe=ce.updateScrollerPosition,me=(0,S.useMemo)((function(){return(0,E.kA)([{role:E.G7.System,content:Z}].concat(P()(B)))}),[B,Z]),he=function(){G.current=G.current+1},ge=function(){var e,t;null===(e=re.current)||void 0===e||null===(t=e.abort)||void 0===t||t.call(e),f(a,!1)},ve=function(e){var t;if($(I()({},null!==(t=null==e?void 0:e.usage)&&void 0!==t?t:{})),e&&C().get(e,"choices",[].length)){oe.current=oe.current+C().get(e,"choices.0.delta.reasoning_content",""),ne.current=ne.current+C().get(e,"choices.0.delta.content","");var n,r=(n={content:ne.current,reasoningContent:oe.current}).reasoningContent&&!n.content?"<think>".concat(n.reasoningContent):n.reasoningContent&&n.content?"<think>".concat(n.reasoningContent,"</think>").concat(n.content):n.content;H([].concat(P()(B),P()(se.current),[{role:E.G7.Assistant,content:r,uid:G.current}]))}},xe=function(){var e=l()(s()().mark((function e(t){var n,r,l,o,i,c,u,d,p,m,h;return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(F.model){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,f(a,!0),he(),null===(n=re.current)||void 0===n||null===(r=n.abort)||void 0===r||r.call(n),re.current=new AbortController,l=re.current.signal,se.current=t?[I()(I()({},t),{},{uid:G.current})]:[],H((function(e){return[].concat(P()(e),P()(se.current))})),ne.current="",oe.current="",o=[{role:E.G7.System,content:Z}].concat(P()(B),P()(se.current)),i=(0,E.kA)(o),c=I()(I()({messages:i},F),{},{stream:!0,stream_options:{include_usage:!0}}),e.next=17,(0,O.U3)({data:c,url:_.qt,signal:l});case 17:if(null==(u=e.sent)||!u.error){e.next=21;break}return $({error:!0,errorMessage:(null==u||null===(d=u.data)||void 0===d||null===(d=d.error)||void 0===d?void 0:d.message)||(null==u||null===(p=u.data)||void 0===p?void 0:p.message)||""}),e.abrupt("return");case 21:return he(),m=u.reader,h=u.decoder,e.next=25,(0,O.LN)(m,h,(function(e){var t;null!=e&&e.error?$({error:!0,errorMessage:(null==e||null===(t=e.error)||void 0===t?void 0:t.message)||(null==e?void 0:e.message)||""}):ve(e)}));case 25:e.next=29;break;case 27:e.prev=27,e.t0=e.catch(2);case 29:return e.prev=29,f(a,!1),e.finish(29);case 32:case"end":return e.stop()}}),e,null,[[2,27,29,32]])})));return function(t){return e.apply(this,arguments)}}(),ye=function(e){var t,n=e.content||null!==(t=e.imgs)&&void 0!==t&&t.length?e:void 0;xe(n)},be=(0,S.useCallback)((function(e,t){j.current?(z(I()(I()({},F),t)),d(I()({},t))):z(I()(I()({},F),e))}),[F,j.current]),je=function(){H([]),$(null),se.current=[]},ke=function(e){he(),H((function(t){return[].concat(P()(t),[I()(I()({},e),{},{uid:G.current})])}))},we=function(e){se.current=[];var t=C().map(e,(function(e){return he(),{role:e.role,content:e.content,uid:G.current}}));$(null),H(t)},Ze=((0,S.useMemo)((function(){return h.filter((function(e){return"empty"!==e.type}))}),[h]),(0,S.useMemo)((function(){var e=[{label:b.formatMessage({id:"common.button.clear"}),key:"clear",icon:(0,V.jsx)(Je.Z,{}),danger:!1,onClick:function(){H([]),M("")}},{label:b.formatMessage({id:"playground.viewcode"}),key:"viewcode",icon:(0,V.jsx)(c.Z,{type:"icon-code"}),onClick:function(){te(!0)}}];return r.length>2&&e.push({label:b.formatMessage({id:"common.button.delete"}),key:"delete",icon:(0,V.jsx)(Ye.Z,{}),danger:!0,onClick:function(){p(a)}}),e}),[r,b]));return(0,S.useEffect)((function(){z(I()(I()({},F),u))}),[u]),(0,S.useEffect)((function(){return function(){ge()}}),[]),(0,S.useEffect)((function(){ae.current&&de(ae.current)}),[ae.current,de]),(0,S.useEffect)((function(){g[a]&&fe()}),[B]),(0,S.useEffect)((function(){B.length>le.current&&fe(),le.current=B.length}),[B.length]),(0,S.useImperativeHandle)(t,(function(){return{submit:ye,abortFetch:ge,addNewMessage:ke,clear:je,presetPrompt:we,setSystemMessage:M,loading:U}})),(0,V.jsxs)("div",{className:"model-item",children:[(0,V.jsxs)("div",{className:"header",children:[(0,V.jsx)("span",{className:"title",children:(0,V.jsx)(Xe.default,{style:{width:"100%"},variant:"borderless",options:h,onChange:function(e){z(I()(I()({},F),{},{model:e})),je()},value:F.model,labelRender:function(e){return(0,V.jsx)(Ke.Z,{ghost:!0,tooltipProps:{placement:"right"},minWidth:60,maxWidth:180,children:e.label})},optionRender:function(e){return(0,V.jsx)(Ke.Z,{ghost:!0,tooltipProps:{placement:"right"},minWidth:60,maxWidth:180,children:e.label})}})}),(0,V.jsx)(_e,{usage:Y,scaleable:!0}),(0,V.jsxs)("span",{className:"action",children:[(0,V.jsx)(et.Z,{menu:{items:Ze},placement:"bottomRight",children:(0,V.jsx)(y.ZP,{type:"text",icon:(0,V.jsx)($e.Z,{style:{fontSize:"14px"}}),size:"small"})}),(0,V.jsx)(tt.Z,{placement:"bottomRight",content:(0,V.jsx)(Ce,{showModelSelector:!1,setParams:z,modelList:r,globalParams:u,selectedModel:F.model,onValuesChange:be}),trigger:["click"],arrow:!1,fresh:!0,title:(0,V.jsx)("div",{children:(0,V.jsx)(ue.Z,{onChange:function(e){j.current=e.target.checked,e.target.checked&&d(I()({},C().omit(F,"model")))},children:b.formatMessage({id:"playground.compare.applytoall"})})}),children:(0,V.jsx)(y.ZP,{type:"text",icon:(0,V.jsx)(Qe.Z,{}),size:"small"})})]})]}),(0,V.jsx)(pe,{showApplyToAll:!0,systemMessage:Z,applyToAll:m,setSystemMessage:M}),(0,V.jsx)("div",{className:"content",ref:ae,children:(0,V.jsxs)("div",{children:[(0,V.jsx)(ie,{messageList:B,setMessageList:H,actions:x,editable:!0}),(0,V.jsx)(A.Z,{spinning:!!g[a],size:"small",style:{width:"100%"}})]})}),(0,V.jsx)(De,I()(I()({},E.NW.chat),{},{open:ee,payload:{messages:me},parameters:F,onCancel:function(){te(!1)},title:b.formatMessage({id:"playground.viewcode"})}))]})})),rt=S.memo(nt),st=function(e){var t=e.spans,n=e.modelSelections,r=e.setModelRefs;return(0,V.jsx)(Be.Z,{gutter:[16,0],style:{height:"100%"},children:n.map((function(e,s){return(0,V.jsx)(He.Z,{span:t.span,style:{height:t.count<4?"calc(100% - 16px)":"calc(50% - 16px)"},children:(0,V.jsx)(rt,{ref:function(t){return r(e.instanceId,t)},instanceId:e.instanceId,modelList:n,model:e.value},"".concat(e.value||"empty","-").concat(e.uid))},"".concat(e.value||"empty","-").concat(e.uid))}))})},at=S.memo(st),lt=function(e){var t=e.modelList,n=e.loaded,r=(0,T.Z)().initialize,a=(0,S.useState)({}),o=i()(a,2),c=o[0],u=o[1],d=(0,S.useState)([]),f=i()(d,2),p=f[0],m=f[1],h=(0,S.useState)({seed:null,stop:null,temperature:1,top_p:1,max_tokens:1024}),g=i()(h,2),v=g[0],x=g[1],y=(0,S.useState)({span:12,count:2}),b=i()(y,2),j=b[0],k=b[1],w=(0,S.useRef)({}),Z=(0,S.useRef)({}),M=(0,S.useRef)(null),_=(0,S.useState)(["upload","delete","copy"]),N=i()(_,2),R=N[0],P=N[1],O=(0,S.useMemo)((function(){return Object.getOwnPropertySymbols(c).some((function(e){return c[e]}))}),[c]),A=((0,S.useMemo)((function(){return t.map((function(e){return I()(I()({},e),{},{disabled:p.some((function(t){return t.value===e.value}))})}))}),[t,p]),function(e){return w.current[e]=C().add(w.current[e],1),w.current[e]}),E=(0,S.useCallback)((function(e,t){Z.current[e]=t}),[]);return(0,S.useEffect)((function(){Z.current={};var e=C().take(t,j.count);if(e.length<j.count&&e.length>0){var n=j.count-e.length,r=Array.from({length:n},(function(e,t){return{label:"",value:"",type:"empty"}}));e=C().concat(e,r)}var s=e.map((function(e){return I()(I()({},e),{},{uid:A(e.value||"empty"),instanceId:"empty"===e.type?Symbol("empty"):Symbol(e.value)})}));m(s)}),[t]),(0,S.useEffect)((function(){M.current&&r(M.current)}),[M.current,r]),(0,V.jsxs)("div",{className:"multiple-chat",style:{height:"calc(100vh - 72px)"},children:[(0,V.jsx)("div",{className:"chat-list",ref:M,children:t.length>0?(0,V.jsx)(We.Provider,{value:{spans:j,globalParams:v,loadingStatus:c,modelFullList:t,actions:R,handleApplySystemChangeToAll:function(e){Object.getOwnPropertySymbols(Z.current).forEach((function(t){var n=Z.current[t];null==n||n.setSystemMessage(e)}))},setGlobalParams:x,setLoadingStatus:function(e,t){u((function(n){var r=I()({},n);return r[e]=t,r}))},handleDeleteModel:function(e){var t,n=p.filter((function(t){return t.instanceId!==e}));!function(e){Z.current[e]=null,c[e]=!1}(e),t=j.count-1,6===j.count?k({span:8,count:t}):5===j.count?k({span:12,count:t}):4===j.count?k({span:8,count:t}):3===j.count&&k({span:12,count:t}),m(n)}},children:(0,V.jsx)(at,{spans:j,modelSelections:p,setModelRefs:E})}):n&&(0,V.jsx)(qe,{style:{height:"100%",paddingBottom:60}})}),(0,V.jsx)("div",{children:(0,V.jsx)(F.Z,{loading:O,disabled:O||!p.length||!t.length,handleSubmit:function(e){Object.getOwnPropertySymbols(Z.current).forEach((function(t){var n=Z.current[t];null==n||n.submit(e)}))},addMessage:function(e){Object.getOwnPropertySymbols(Z.current).forEach((function(t){var n=Z.current[t];null==n||n.addNewMessage(e)}))},handleAbortFetch:function(){Object.getOwnPropertySymbols(Z.current).forEach((function(e){var t=Z.current[e];null==t||t.abortFetch()}))},clearAll:function(){Object.getOwnPropertySymbols(Z.current).forEach((function(e){var t=Z.current[e];null==t||t.clear()}))},updateLayout:function(e){k(e),function(e){var n=p;if(n.length<e.count){var r=e.count-n.length,s=C().slice(t,n.length,n.length+r),a=Array.from({length:r-s.length},(function(e,t){return{label:"",value:"",type:"empty"}})),l=C().concat(s,a).map((function(e){return I()(I()({},e),{},{uid:A(e.value||"empty"),instanceId:"empty"===e.type?Symbol("empty"):Symbol(e.value)})}));m(C().concat(n,l))}else if(n.length>e.count){var o=n.slice(0,e.count);m(o)}}(e)},setModelSelections:function(e){var t=e.map((function(e){return I()(I()({},e),{},{uid:A(e.value),instanceId:Symbol(e.value)})})),n=C().concat(p,t),r=Math.floor(24/n.length);k({span:r<8?8:r,count:j.count}),m(n)},presetPrompt:function(e){var t=e.filter((function(e){return"system"===e.role})),n=e.filter((function(e){return"user"===e.role}));Object.getOwnPropertySymbols(Z.current).forEach(function(){var e=l()(s()().mark((function e(r){var a;return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null==(a=Z.current[r])||a.presetPrompt(n),null==a||a.setSystemMessage(C().get(t,"0.content",""));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())},actions:["clear","layout","role","upload","add","paste","check"],defaultChecked:!1,checkLabel:"Markdown",onCheck:function(e){var t=e.target.checked;P(t?["upload","delete","copy","markdown"]:["upload","delete","copy"])},defaultSize:{minRows:5,maxRows:5}})})]})},ot=(0,S.memo)(lt),it=(n(64232),function(){var e=(0,v.useIntl)(),t=(0,f.Z)().size,n=(0,S.useState)("chat"),r=i()(n,2),a=r[0],o=r[1],k=(0,S.useRef)(null),Z=(0,S.useRef)(null),N=(0,S.useState)([]),I=i()(N,2),R=I[0],P=I[1],T=(0,S.useState)(!1),O=i()(T,2),A=O[0],E=O[1],F=[{label:e.formatMessage({id:"menu.playground.chat"}),value:"chat",icon:(0,V.jsx)(m.Z,{})},{label:e.formatMessage({id:"menu.compare"}),value:"compare",icon:(0,V.jsx)(h.Z,{})}],z=(0,S.useCallback)((function(){var e,t;if("reranker"===a)null===(e=Z.current)||void 0===e||null===(t=e.viewCode)||void 0===t||t.call(e);else if("chat"===a){var n,r;null===(n=k.current)||void 0===n||null===(r=n.viewCode)||void 0===r||r.call(n)}}),[k,Z,a]),L=(0,S.useCallback)((function(){var e,t,n,r;"reranker"!==a?null===(e=k.current)||void 0===e||null===(t=e.setCollapse)||void 0===t||t.call(e):null===(n=Z.current)||void 0===n||null===(r=n.setCollapse)||void 0===r||r.call(n)}),[k,Z,a]),D=[{key:"chat",label:"Chat",children:(0,V.jsx)(Ge,{ref:k,modelList:R})},{key:"compare",label:"Compare",children:(0,V.jsx)(ot,{modelList:R,loaded:A})}];(0,S.useEffect)((function(){var e,n,r;t.width<u.Z.lg&&(null!==(e=k.current)&&void 0!==e&&e.collapse||null===(n=k.current)||void 0===n||null===(r=n.setCollapse)||void 0===r||r.call(n))}),[t.width]),(0,S.useEffect)((function(){var e=function(){var e=l()(s()().mark((function e(){var t,n,r;return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t={categories:p.Us.llm,with_meta:!0},e.next=4,(0,_.nb)(t);case 4:return n=e.sent,r=C().map(n.data||[],(function(e){return{value:e.id,label:e.id,meta:e.meta}})),e.abrupt("return",r);case 9:return e.prev=9,e.t0=e.catch(0),e.abrupt("return",[]);case 13:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(){return e.apply(this,arguments)}}(),t=function(){var t=l()(s()().mark((function t(){var n;return s()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e();case 3:n=t.sent,P(n),t.next=10;break;case 7:t.prev=7,t.t0=t.catch(0),E(!0);case 10:case"end":return t.stop()}}),t,null,[[0,7]])})));return function(){return t.apply(this,arguments)}}();t()}),[]);return(0,M.y1)(d.ZP.RIGHT.join(","),(function(){var e,t;null===(e=k.current)||void 0===e||null===(t=e.setCollapse)||void 0===t||t.call(e)}),{preventDefault:!0}),(0,V.jsx)(g._z,{ghost:!0,header:{title:(0,V.jsxs)("div",{className:"flex items-center",children:[(0,V.jsx)("span",{className:"font-600",children:e.formatMessage({id:"menu.playground.chat"})}),(0,V.jsx)(b.Z,{options:F,size:"middle",className:"m-l-40",onChange:function(e){return o(e)}})]}),breadcrumb:{}},extra:"compare"!==a&&(0,V.jsxs)(x.Z,{children:[(0,V.jsx)(y.ZP,{size:"middle",onClick:z,icon:(0,V.jsx)(c.Z,{type:"icon-code",className:"font-size-16"}),children:e.formatMessage({id:"playground.viewcode"})}),(0,V.jsx)(y.ZP,{size:"middle",onClick:L,icon:(0,V.jsx)(c.Z,{type:"icon-a-layout6-line",className:"font-size-16"})})]},"buttons"),className:w()("playground-container",{compare:"compare"===a,chat:"compare"!==a}),children:(0,V.jsx)("div",{className:"play-ground",children:(0,V.jsx)("div",{className:"chat",children:(0,V.jsx)(j.Z,{items:D,activeKey:a})})})})})},69510:function(e,t,n){n.d(t,{HH:function(){return _},LN:function(){return N},U3:function(){return S},YT:function(){return R}});var r=n(335),s=n.n(r),a=n(15558),l=n.n(a),o=n(25298),i=n.n(o),c=n(17069),u=n.n(c),d=n(82092),f=n.n(d),p=n(31759),m=n.n(p),h=n(26068),g=n.n(h),v=n(90228),x=n.n(v),y=n(87999),b=n.n(y),j=n(32699),k=n(28694),w=/data:\s*({.*?})(?=\n|$)/g,Z=function(e){var t,n=[];if(!e)return n;for(;null!==(t=w.exec(e));)try{var r=JSON.parse(t[1]);n.push(r)}catch(e){continue}return n},C=function(){var e=b()(x()().mark((function e(t){var n;return x()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.json();case 3:return n=e.sent,e.abrupt("return",{error:!0,data:n});case 8:return e.prev=8,e.t0=e.catch(0),e.abrupt("return",{error:!0,message:t.statusText});case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t){return e.apply(this,arguments)}}(),S=function(){var e=b()(x()().mark((function e(t){var n,r,s,a,l,o;return x()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.method||"POST",s=t.url,t.params&&(s="".concat(s,"?").concat(k.Z.stringify(t.params))),e.next=5,fetch(s,{method:r,body:"POST"===r?JSON.stringify(t.data):null,signal:t.signal,headers:g()({"Content-Type":"application/json"},t.headers)});case 5:if((a=e.sent).ok){e.next=10;break}return e.next=9,C(a);case 9:return e.abrupt("return",e.sent);case 10:return l=null==a||null===(n=a.body)||void 0===n?void 0:n.getReader(),o=new TextDecoder("utf-8",{fatal:!0}),e.abrupt("return",{reader:l,decoder:o});case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),M=function(e){var t=new FormData,n=function(e,n){n instanceof File?t.append(e,n):"object"===m()(n)&&null!==n?t.append(e,JSON.stringify(n)):null!=n&&t.append(e,n)};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&n(r,e[r]);return t},_=function(){var e=b()(x()().mark((function e(t){var n,r,s,a,l;return x()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.url,e.next=3,fetch(r,{method:"POST",body:M(t.data),signal:t.signal});case 3:if((s=e.sent).ok){e.next=9;break}return e.next=7,C(s);case 7:return e.t0=e.sent,e.abrupt("return",{error:!0,data:e.t0});case 9:return a=null==s||null===(n=s.body)||void 0===n?void 0:n.getReader(),l=new TextDecoder("utf-8",{fatal:!0}),e.abrupt("return",{reader:a,decoder:l});case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),N=function(){var e=b()(x()().mark((function e(t,n,r){var s,a,o,c,d,p,m,h,g,v,y=arguments;return x()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:s=y.length>3&&void 0!==y[3]?y[3]:200,a=new(function(){function e(){i()(this,e),f()(this,"buffer",[])}return u()(e,[{key:"add",value:function(e){this.buffer.push(e)}},{key:"flush",value:function(){if(this.buffer.length>0){var e=l()(this.buffer);this.buffer=[],e.forEach((function(e){return r(e)}))}}},{key:"getBuffer",value:function(){return this.buffer}}]),e}()),o=(0,j.throttle)((function(){a.flush()}),s),c=!0;case 5:if(!c){e.next=18;break}return e.next=8,t.read();case 8:if(d=e.sent,p=d.done,m=d.value,!p){e.next=15;break}return c=!1,a.flush(),e.abrupt("break",18);case 15:try{(h=n.decode(m,{stream:!0})).startsWith("error:")?(g=h.slice(7).trim(),v=JSON.parse(g),a.add({error:v})):Z(h).forEach((function(e){a.add(e)})),o()}catch(e){a.add({error:e})}e.next=5;break;case 18:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),I=function(){var e=b()(x()().mark((function e(t,n){var r,a,l,o,i,c,u,d,f;return x()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return");case 2:r=t.split("\n"),a=s()(r);try{for(a.s();!(l=a.n()).done;)if(o=l.value,(i=o.trim()).startsWith("data: ")){c=i.slice(6).trim();try{"[DONE]"!==c&&(u=JSON.parse(c),n(u))}catch(e){}}else if(i.startsWith("error:")){d=i.slice(7).trim();try{f=JSON.parse(d),n({error:f})}catch(e){}}}catch(e){a.e(e)}finally{a.f()}case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),R=function(){var e=b()(x()().mark((function e(t,n,r){var a,l,o,c,d,p,m,h,g,v,y,k,w,Z=arguments;return x()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=Z.length>3&&void 0!==Z[3]?Z[3]:200,l="",o=function(){function e(t){i()(this,e),f()(this,"buffer",[]),f()(this,"failed",!1),f()(this,"isFlushing",!1),f()(this,"callback",void 0),this.callback=t}var t;return u()(e,[{key:"add",value:function(e){this.buffer.push(e)}},{key:"flush",value:(t=b()(x()().mark((function e(){var t;return x()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==this.buffer.length&&!this.isFlushing){e.next=2;break}return e.abrupt("return");case 2:this.failed=!1,this.isFlushing=!0;case 4:if(!(this.buffer.length>0)){e.next=18;break}t=this.buffer.shift(),e.prev=6,I(t,this.callback),e.next=16;break;case 10:return e.prev=10,e.t0=e.catch(6),this.failed=!0,this.buffer.unshift(t),e.abrupt("break",18);case 16:e.next=4;break;case 18:this.isFlushing=!1;case 19:case"end":return e.stop()}}),e,this,[[6,10]])}))),function(){return t.apply(this,arguments)})},{key:"getBuffer",value:function(){return this.buffer}}]),e}(),c=new o(r),d=(0,j.throttle)(b()(x()().mark((function e(){return x()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:c.flush();case 1:case"end":return e.stop()}}),e)}))),a),!0;case 6:return e.next=9,null==t||null===(p=t.read)||void 0===p?void 0:p.call(t);case 9:if(m=e.sent,h=m.done,g=m.value,!h){e.next=17;break}return!1,l&&c.add(l),c.flush(),e.abrupt("break",20);case 17:try{l+=n.decode(g,{stream:!0}),v=l.split("\n"),l=v.pop()||"",y=s()(v);try{for(y.s();!(k=y.n()).done;)w=k.value,c.add(w)}catch(e){y.e(e)}finally{y.f()}d()}catch(e){}e.next=6;break;case 20:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}()}}]);