import{d as O,i as F,a as h,c as _,o as k,b as te,B as he,e as x,f as d,t as A,g as ge,r as B,p as I,w as N,F as ye,h as D,u as ne,_ as G,j as Ce,k as oe,l as Q,v as Z,m as se,n as be,q as Se,W as we,s as Ee,x as Ie,y as ae,z as re,A as ie,C as Pe,D as Te,E as Me,G as $e,H as ke,I as De,J as Ae,K as ee}from"./index-BEZl8isL.js";import{f as Be}from"./instancePath-BsbOTTI8.js";const Fe=10,Re=O({__name:"ChildlessPlaceholder",props:{componentId:{type:String,required:!0}},setup(u){const o=F(h.core),v=u,p=(C,i)=>{const S=C.map(l=>o.getComponentDefinition(l)).map(l=>l==null?void 0:l.name);return`${S.slice(0,-1).join(", ")} ${S.length>1?i:""} ${S.at(-1)}`},s=_(()=>{const C=o.getContainableTypes(v.componentId);let i;return C.length<=Fe&&(i=`You can add ${p(C,"and")} components`),i});return(C,i)=>(k(),te(he,{class:"ChildlessPlaceholder","component-id":u.componentId,message:s.value},null,8,["component-id","message"]))}}),Ve={class:"RenderError"},xe={class:"title"},Le={class:"message"},We=O({__name:"RenderError",props:{componentType:{},message:{}},setup(u){const o=u;return(v,p)=>(k(),x("div",Ve,[d("div",xe,[d("h2",null,"Error rendering "+A(o.componentType),1)]),d("div",Le,A(o.message),1)]))}}),He={props:{componentId:{type:String,required:!0},instancePath:{type:Array,required:!0},instanceData:{type:Array,required:!0}},setup(u){const o=F(h.core),v=F(h.builderManager),p=u.componentId,s=_(()=>o.getComponentById(p)),C=ge(s.value.type),i=u.instancePath,P=u.instanceData,{getEvaluatedFields:S,isComponentVisible:M}=ne(o),l=S(i),E=_(()=>o.getComponents(p,{sortedByPosition:!0})),w=_(()=>!!v&&v.getMode()!="preview"),q=_(()=>{var t;return w.value&&!s.value.isCodeManaged&&s.value.type!=="root"&&s.value.type!=="workflows_root"&&((t=U.value)==null?void 0:t.toolkit)!=="workflows"}),L=(t,a)=>(t?o.getContainableTypes(t):["root","workflows_root"]).includes(a),R=B(!1),e=()=>{if(!(E.value.length>0))return D(Re,{componentId:s.value.id})},n=(t,a=0,c)=>D(le,{componentId:t,key:`${t}:${a}`,instancePath:[...i,{componentId:t,instanceNumber:a}],instanceData:[...P,B(null)],...c??{}}),r=t=>a=>{if(!L(p,a.type)&&t==="default")return!0;const g=o.getComponentDefinition(a.type).slot??"default";return g==="*"||g===t},m=(t=0,a="default",c=()=>!0,g=!1)=>{const f=y=>!w.value||g?[]:[D("div",{"data-writer-slot-of-id":p,"data-writer-position":y})],b=E.value.filter(r(a)).filter(c),$=b.filter(y=>!y.isCodeManaged).map(y=>n(y.id,t,{contextSlot:a})),V=b.filter(y=>y.isCodeManaged).map(y=>n(y.id,t,{contextSlot:a}));return[...f(0),...$.map((y,H)=>[y,f(H+1)]).flat(),...V]},T=Be(i);I(h.evaluatedFields,l),I(h.componentId,p),I(h.isBeingEdited,w),I(h.isDisabled,R),I(h.instancePath,i),I(h.instanceData,P),I(h.renderProxiedComponent,n),I(h.getChildrenVNodes,m),I(h.flattenedInstancePath,T);const W={"data-writer-id":p,"data-writer-instance-path":T},U=_(()=>o.getComponentDefinition(s.value.type)),z=_(()=>{var t;return(t=U.value)==null?void 0:t.fields}),K=B(!1);N(()=>v==null?void 0:v.isComponentIdSelected(p),t=>{K.value=t});const ce=_(()=>Object.entries(z.value).filter(([,t])=>t.category===ye.Style).reduce((t,[a])=>(t[a]=l[a].value,t),{}));N(ce,()=>K.value=!1);const X=_(()=>E.value.length==0),de=_(()=>M(p,i)),ue=(t,a)=>{if(!t.startsWith("$goToPage_")&&!a)return g=>{let f=!1;o.userFunctions.value.some(b=>b.name==t&&b.args.includes("payload"))&&(f=!0),t.startsWith("$runWorkflow_")&&(f=!0),o.forwardEvent(g,i,f)};if(t.startsWith("$goToPage_")){const g=t.substring(10);return f=>o.setActivePageFromKey(g)}return null},pe=_(()=>{const t={},a=Object.keys(s.value.handlers??{}),c=s.value.binding?[s.value.binding.eventType]:[];return Array.from(new Set([...a,...c])).forEach(f=>{var V;const b=`on${f.charAt(0).toUpperCase()}${f.slice(1)}`,$=f===((V=s.value.binding)==null?void 0:V.eventType);t[b]=y=>{var Y,J;$&&o.forwardEvent(y,i,!0);const H=(Y=s.value.handlers)==null?void 0:Y[f];H&&((J=ue(H,$))==null||J(y))}}),t}),me=_(()=>{const t=z.value;if(!t)return;const a={};return Object.keys(t).forEach(c=>{t[c].applyStyleVariable&&l[c]&&(a[`--${c}`]=l[c].value)}),a}),fe=_(()=>{const t="cssClasses",a=z.value;if(!a||!a[t]||!l[t])return;const c=String(l[t].value),g=c==null?void 0:c.split(" ").map(b=>b.trim()),f={};return g.forEach(b=>{f[b]=!0}),f}),ve=function(){return{class:{[`wf-type-${s.value.type}`]:!0,component:!0,childless:X.value,selected:K.value,disabled:R.value,beingEdited:w.value,...fe.value},style:{...me.value,...de.value?{}:{display:"none"}},...W,...R.value?[]:pe.value,draggable:q.value}},_e=(t,a)=>w.value?D(We,{...t,componentType:s.value.type,message:a}):D("div");return()=>{const t=w.value?e():void 0,a=({instanceNumber:g=0,slotName:f="default",componentFilter:b=()=>!0,positionlessSlot:$=!1})=>X.value?$?void 0:t:m(g,f,b,$),c={...ve()};return L(s.value.parentId,s.value.type)?D(C,c,{default:a}):_e(c,"Parent is not suitable for this component")}}},le=G(He,[["__scopeId","data-v-48acb661"]]),j=u=>(re("data-v-c40dd3f4"),u=u(),ie(),u),Oe=j(()=>d("i",{class:"icon material-symbols-outlined"}," notifications ",-1)),je={class:"counter"},qe=j(()=>d("div",{class:"balloonFlash"},null,-1)),ze={class:"main"},Ke={class:"clearContainer"},Ne=j(()=>d("i",{class:"material-symbols-outlined"}," clear_all ",-1)),Ge=j(()=>d("i",{class:"material-symbols-outlined"}," exclamation ",-1)),Ue=[Ge],Xe={class:"content"},Ye={class:"title"},Je={class:"time"},Qe={class:"message"},Ze=100,et=O({__name:"RendererNotifications",setup(u){const o=F(h.core),v=B(!1),p=B(null),s=Ce([]),C=S=>{const{type:M,title:l,message:E,code:w}=S;s.unshift({type:M,title:l,message:E,code:w,timestampReceived:new Date}),s.splice(Ze),p.value.classList.remove("alert"),p.value.offsetWidth,p.value.classList.add("alert")};oe(()=>{o.addMailSubscription("notification",C)});const i=()=>{s.length!=0&&(v.value=!v.value)},P=()=>{s.splice(0),v.value=!1};return(S,M)=>Q((k(),x("div",{class:"RendererNotifications colorTransformer",onClick:i},[d("div",{ref_key:"balloon",ref:p,class:"balloon",title:"Toggle notifications"},[Oe,d("div",je,A(s.length),1)],512),qe,Q(d("div",ze,[d("div",Ke,[se(we,{onClick:P},{default:be(()=>[Ne,Se(" Clear all ")]),_:1})]),(k(!0),x(Ee,null,Ie(s,(l,E)=>(k(),x("div",{key:E,class:"notification"},[d("div",{class:ae(["icon",l.type])},Ue,2),d("div",Xe,[d("header",null,[d("strong",Ye,A(l.title),1),d("span",Je,A(l.timestampReceived.toLocaleTimeString()),1)]),d("div",Qe,A(l.message),1)])]))),128))],512),[[Z,v.value]])],512)),[[Z,s.length>0]])}}),tt=G(et,[["__scopeId","data-v-c40dd3f4"]]),nt=u=>(re("data-v-44c555ab"),u=u(),ie(),u),ot=nt(()=>d("div",{class:"loadingBar"},null,-1)),st={class:"rootComponentArea"},at=O({__name:"ComponentRenderer",setup(u){const o=F(h.core),v=F(h.builderManager),p=ne(o),s={},C=_(()=>v&&v.getMode()=="workflows"?"workflows_root":"root"),i=p.getEvaluatedFields([{componentId:"root",instanceNumber:0}]),P=_(()=>{var e,n,r,m,T,W;return{...Pe,"--accentColor":(e=i.accentColor)==null?void 0:e.value,"--emptinessColor":(n=i.emptinessColor)==null?void 0:n.value,"--containerBackgroundColor":(r=i.parentIdBackgroundColor)==null?void 0:r.value,"--primaryTextColor":(m=i.primaryTextColor)==null?void 0:m.value,"--secondaryTextColor":(T=i.secondaryTextColor)==null?void 0:T.value,"--separatorColor":(W=i.separatorColor)==null?void 0:W.value}}),S=_(()=>o.frontendMessageMap.value.size>0);N(()=>{var e;return(e=i.appName)==null?void 0:e.value},e=>{e!=""&&M(e)},{immediate:!0});function M(e){const n=o.mode.value;let r;e&&n=="edit"?r=`${e} | Writer Framework | Builder`:!e&&n=="edit"?r="Writer Framework | Builder":e&&n=="run"?r=`${e}`:!e&&n=="run"&&(r="Writer Framework App"),document.title=r}async function l(e,n){const r=document.querySelector(`[data-writer-stylesheet-key="${e}"]`);r==null||r.remove();const m=document.createElement("link");m.dataset.writerStylesheetKey=e,m.setAttribute("href",n),m.setAttribute("rel","stylesheet"),document.head.appendChild(m)}async function E(e,n){const r=document.querySelector(`[data-writer-script-key="${e}"]`);r==null||r.remove();const m=document.createElement("script");m.dataset.writerScriptKey=e,m.src=n,m.setAttribute("rel","modulepreload"),document.head.appendChild(m)}async function w(e,n){s[e]=n,await ee(()=>import(n),[],import.meta.url)}async function q(e,n,r){const m=s[e],T=await ee(()=>import(m),[],import.meta.url);if(!T){console.warn(`The module with key "${e}" cannot be found. Please check that it has been imported.`);return}T[n](...r)}function L(){o.addMailSubscription("fileDownload",e=>{const n=document.createElement("a");n.href=e.data,n.download=e.fileName,n.click()}),o.addMailSubscription("openUrl",e=>{const n=document.createElement("a");n.href=e,n.target="_blank",n.rel="noopener noreferrer",n.click()}),o.addMailSubscription("pageChange",e=>{ke(e)}),o.addMailSubscription("routeVarsChange",e=>{De(e)}),o.addMailSubscription("importStylesheet",({stylesheetKey:e,path:n})=>{l(e,n)}),o.addMailSubscription("importScript",({scriptKey:e,path:n})=>{E(e,n)}),o.addMailSubscription("importModule",({moduleKey:e,specifier:n})=>{w(e,n)}),o.addMailSubscription("functionCall",({moduleKey:e,functionName:n,args:r})=>{q(e,n,r)})}function R(){const e=Ae(),n=new CustomEvent("wf-app-open",{detail:{payload:e}}),r={componentId:"root",instanceNumber:0};o.forwardEvent(n,[r],!0)}return Te(()=>{L()}),oe(()=>{R()}),(e,n)=>(k(),x("main",{class:ae(["ComponentRenderer",{loadingActive:S.value}]),tabindex:"-1",style:$e(P.value)},[se(tt,{class:"notifications"}),ot,d("div",st,[(k(),te(le,{key:C.value,"component-id":C.value,"instance-path":[{componentId:C.value,instanceNumber:0}],"instance-data":[B(null)]},null,8,["component-id","instance-path","instance-data"])),Me(e.$slots,"default",{},void 0,!0)])],6))}}),lt=G(at,[["__scopeId","data-v-44c555ab"]]);export{lt as default};
