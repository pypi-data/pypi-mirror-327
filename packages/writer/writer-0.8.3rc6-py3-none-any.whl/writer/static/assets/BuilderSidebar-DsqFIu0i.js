import{d as A,aE as fe,aF as _e,o as l,e as v,f as r,m as x,ad as ve,E as K,_ as M,i as L,a as V,r as N,c as _,aN as ge,aO as Q,w as ee,b as D,n as B,s as I,x as U,t as H,aP as he,aQ as ye,aj as te,R as O,L as $,N as J,P as oe,u as we,z as ne,A as ae,W as Y,q as Z}from"./index-BEZl8isL.js";import{T as be}from"./BuilderApp-enbW7Uwi.js";import"./useFocusWithin-D9cSjn1O.js";import"./marked.esm-273vDTCT.js";const ke={class:"BuilderSidebarPanel"},Ce={class:"BuilderSidebarPanel__inputContainer"},Ie={class:"BuilderSidebarPanel__main"},Be={class:"BuilderSidebarPanel__footer"},Se=A({__name:"BuilderSidebarPanel",props:fe({placeholder:{}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(p){const f=_e(p,"modelValue");return(o,d)=>(l(),v("div",ke,[r("div",Ce,[x(ve,{modelValue:f.value,"onUpdate:modelValue":d[0]||(d[0]=c=>f.value=c),class:"searchInput","left-icon":"search","data-automation-action":"search",placeholder:o.placeholder},null,8,["modelValue","placeholder"])]),r("div",Ie,[K(o.$slots,"default",{},void 0,!0)]),r("div",Be,[K(o.$slots,"footer",{},void 0,!0)])]))}}),re=M(Se,[["__scopeId","data-v-96912514"]]),Te={class:"header"},$e={class:"tools"},De=["data-writer-tooltip","data-component-type","onDragstart"],Le={class:"name"},Ve=A({__name:"BuilderSidebarToolkit",setup(p){const f=L(V.core),o=L(V.builderManager),{removeInsertionCandidacy:d}=te(f),c=N(""),k=["Layout","Content","Input","Embed","Writer","Logic","Other"],h=_(()=>o.getMode()=="workflows"?"workflows":"core"),q=_(()=>{const m=k.map(u=>[u,T(u)]).filter(([u,y])=>y.length>0);return Object.fromEntries(m)}),g=_(()=>h.value=="core"?"Core toolkit":h.value=="workflows"?"Workflows toolkit":"Toolkit");function T(m){const y=ge().filter(t=>{const w=Q(t);return!(w.category!=m||!w.toolkit&&h.value!=="core"||w.toolkit&&w.toolkit!==h.value)}).map(t=>{const{name:w,description:F,category:E}=Q(t);return{type:t,name:w,description:F,category:E??"Other"}}),C=c.value.toLocaleLowerCase();return y.filter(t=>!C||t.name.toLocaleLowerCase().includes(C))}function P(m,u){o.setSelection(null),m.dataTransfer.setData(`application/json;writer=${u},`,"{}")}function W(m){d(m)}function j(m){return[`/components/${m.type}.svg`,`/components/category_${m.category}.svg`].map(u=>ye(u))}return ee(h,()=>{c.value=""}),(m,u)=>(l(),D(re,{modelValue:c.value,"onUpdate:modelValue":u[1]||(u[1]=y=>c.value=y),class:"BuilderSidebarToolkit",placeholder:g.value},{default:B(()=>[(l(!0),v(I,null,U(q.value,(y,C)=>(l(),v("div",{key:C,class:"category"},[r("div",Te,H(C),1),r("div",$e,[(l(!0),v(I,null,U(y,s=>(l(),v("div",{key:s.type,class:"tool","data-writer-tooltip":s.description,"data-writer-tooltip-placement":"right","data-writer-tooltip-gap":"8",draggable:"true","data-component-type":s.type,onDragend:u[0]||(u[0]=t=>W(t)),onDragstart:t=>P(t,s.type)},[x(he,{alt:`(Icon for ${s.name})`,draggable:"false",urls:j(s)},null,8,["alt","urls"]),r("div",Le,H(s.name),1)],40,De))),128))])]))),128))]),_:1},8,["modelValue","placeholder"]))}}),qe=M(Ve,[["__scopeId","data-v-db73a34d"]]),S=p=>(ne("data-v-7fbca688"),p=p(),ae(),p),Pe={class:"BuilderSidebarComponentTreeBranch__nameRight"},Ee=S(()=>r("span",{class:"middot"},null,-1)),xe=S(()=>r("i",{class:"material-symbols-outlined"},"bolt",-1)),Ae=S(()=>r("span",{class:"middot"},null,-1)),Me=S(()=>r("i",{class:"material-symbols-outlined"},"visibility_off",-1)),We=S(()=>r("span",{class:"middot"},null,-1)),je=S(()=>r("i",{class:"material-symbols-outlined"},"terminal",-1)),Fe=S(()=>r("span",{class:"middot"},null,-1)),Re={class:"previewText"},Ne=A({__name:"BuilderSidebarComponentTreeBranch",props:{componentId:{},query:{}},emits:["expandBranch"],setup(p,{emit:f}){const o=N(),d=L(V.core),c=L(V.builderManager),k=N(!1),h=_(()=>c.isComponentIdSelected(s.componentId)),{createAndInsertComponent:q,moveComponent:g,goToComponentParentPage:T,isDraggingAllowed:P}=oe(d,c),{getComponentInfoFromDrag:W,removeInsertionCandidacy:j,isParentSuitable:m}=te(d),{isComponentVisible:u}=we(d),y=f,C=_(()=>{var a,i;const e=(a=s.query)==null?void 0:a.toLocaleLowerCase();return!!(!e||(i=E.value)!=null&&i.name.toLocaleLowerCase().includes(e)||Object.values(t.value.content).filter(b=>b.toLocaleLowerCase().includes(e)).length>0)}),s=p,t=_(()=>d.getComponentById(s.componentId)),w=_(()=>d.getComponents(s.componentId,{sortedByPosition:!0})),F=_(()=>{var b,R;const e=(b=E.value)==null?void 0:b.previewField;if(!e)return;const n=(R=t.value.content)==null?void 0:R[e];let a;const i=70;return(n==null?void 0:n.length)>i?a=n.substring(0,i)+"...":a=n,a}),E=_(()=>d.getComponentDefinition(t.value.type)),ie=_(()=>{var n,a,i,b;const e=t.value.type;return e=="html"&&((n=t.value.content)!=null&&n.element)?(a=t.value.content)==null?void 0:a.element:e=="workflows_workflow"?((i=t.value.content)==null?void 0:i.key)||"Workflow":((b=E.value)==null?void 0:b.name)??`Unknown (${t.value.type})`});async function de(e){T(s.componentId),await O(),c.handleSelectionFromEvent(e,s.componentId,void 0,"tree"),z()}function z(){o.value&&(o.value.expand(),k.value=!1,y("expandBranch"),X({onlyHorizontal:!0}))}function X(e){var G;const n=(G=o.value)==null?void 0:G.$el;if(!n)return;const a=n.closest(".BuilderSidebarComponentTree"),i=a.getBoundingClientRect(),b=o.value.$el.offsetTop-i.height/2,R=o.value.$el.offsetLeft-i.left-16;a.scrollTo({top:e!=null&&e.onlyHorizontal?void 0:b,left:Math.max(0,R),behavior:"smooth"})}function ce(e){c.setSelection(null),e.dataTransfer.setData(`application/json;writer=${t.value.type},${t.value.id}`,"{}")}function ue(e){j(e)}function pe(e){const n=W(e);if(!n)return;const{draggedType:a,draggedId:i}=n;m(s.componentId,i,a)&&e.preventDefault()}function me(e){const n=W(e);if(!n)return;const{draggedType:a,draggedId:i}=n;i?g(i,t.value.id):q(a,t.value.id),j(e)}return ee(c.firstSelectedItem,async e=>{e&&e.componentId===s.componentId&&e.source!="tree"&&(z(),await O(),X())},{immediate:!0}),(e,n)=>(l(),D(be,{ref_key:"treeBranch",ref:o,class:"BuilderSidebarComponentTreeBranch","component-id":e.componentId,name:ie.value,query:e.query,"has-children":w.value.length>0,"data-automation-key":t.value.type,draggable:J(P)(e.componentId),matched:C.value,selected:h.value,onSelect:de,onDragover:pe,onDragstart:ce,onDragend:ue,onDrop:me},{nameRight:B(()=>[r("span",Pe,[Object.keys(t.value.handlers??{}).length>0?(l(),v(I,{key:0},[Ee,xe],64)):$("",!0),J(u)(t.value.id)?$("",!0):(l(),v(I,{key:1},[Ae,Me],64)),t.value.isCodeManaged?(l(),v(I,{key:2},[We,je],64)):$("",!0),F.value?(l(),v(I,{key:3},[Fe,r("span",Re,H(F.value),1)],64)):$("",!0)])]),children:B(()=>[(l(!0),v(I,null,U(w.value,a=>(l(),D(se,{key:a.id,"component-id":a.id,query:e.query,onExpandBranch:z},null,8,["component-id","query"]))),128))]),_:1},8,["component-id","name","query","has-children","data-automation-key","draggable","matched","selected"]))}}),se=M(Ne,[["__scopeId","data-v-7fbca688"]]),le=p=>(ne("data-v-d7710d4c"),p=p(),ae(),p),Oe={class:"add"},ze=le(()=>r("i",{class:"material-symbols-outlined"}," add ",-1)),Ue=le(()=>r("i",{class:"material-symbols-outlined"}," add ",-1)),He=A({__name:"BuilderSidebarComponentTree",setup(p){const f=L(V.core),o=L(V.builderManager),d=N(""),{createAndInsertComponent:c}=oe(f,o),k=_(()=>o.getMode()=="workflows"?"workflows_root":"root");async function h(){const g=c("page","root");f.setActivePageId(g),await O(),o.setSelection(g)}async function q(){const g=c("workflows_workflow","workflows_root");f.setActivePageId(g),await O(),o.setSelection(g)}return(g,T)=>(l(),D(re,{modelValue:d.value,"onUpdate:modelValue":T[0]||(T[0]=P=>d.value=P),class:"BuilderSidebarComponentTree",placeholder:"Component tree"},{footer:B(()=>[r("div",Oe,[k.value=="root"?(l(),D(Y,{key:0,variant:"special",size:"small","data-automation-action":"add-page",onClick:h},{default:B(()=>[ze,Z(" Add page")]),_:1})):$("",!0),k.value=="workflows_root"?(l(),D(Y,{key:1,variant:"special",size:"small","data-automation-action":"add-workflow",onClick:q},{default:B(()=>[Ue,Z(" Add workflow")]),_:1})):$("",!0)])]),default:B(()=>[r("div",null,[x(se,{class:"rootBranch","component-id":k.value,query:d.value},null,8,["component-id","query"])])]),_:1},8,["modelValue"]))}}),Xe=M(He,[["__scopeId","data-v-d7710d4c"]]),Ge={class:"BuilderSidebar"},Ke=A({__name:"BuilderSidebar",setup(p){return(f,o)=>(l(),v("div",Ge,[x(qe),x(Xe)]))}}),et=M(Ke,[["__scopeId","data-v-c1777f55"]]);export{et as default};
