import{e as Q}from"./BuilderEmbeddedCodeEditor-BPXNlHcT.js";import{d as X,i as V,a as F,c as v,r as N,ag as Z,N as ee,o as m,e as _,f as l,s as $,x as A,m as i,n as d,q as w,W as k,b as W,l as te,L as C,ad as oe,t as ne,z as le,A as ae,P as se,_ as ie}from"./index-BEZl8isL.js";import{B as x}from"./BuilderApp-enbW7Uwi.js";import{B as K,W as H}from"./BuilderSettings-C5qYB46P.js";import"./useFocusWithin-D9cSjn1O.js";import"./marked.esm-273vDTCT.js";import"./instancePath-BsbOTTI8.js";const f=h=>(le("data-v-b9d5b6a3"),h=h(),ae(),h),re={key:0,class:"BuilderSettingsHandlers"},de=f(()=>l("div",{class:"BuilderSettingsHandlers__title"},[l("i",{class:"material-symbols-outlined"},"bolt"),l("h3",null,"Events")],-1)),ue={class:"BuilderSettingsHandlers__list"},ce={class:"columns"},pe=f(()=>l("i",{class:"material-symbols-outlined"},"add",-1)),me=f(()=>l("div",{class:"stubMessage"}," You can use the following stub code as a starting point for your event handler. ",-1)),ve={class:"codeContainer"},fe=f(()=>l("i",{class:"material-symbols-outlined"},"content_copy",-1)),he={class:"customHandlerModalForm"},_e={id:"commonEventTypes"},ye=["value"],be=f(()=>l("i",{class:"material-symbols-outlined"},"add",-1)),ge=X({__name:"BuilderSettingsHandlers",setup(h){const u=V(F.core),y=V(F.builderManager),{setHandlerValue:S}=se(u,y),r=v(()=>u.getComponentById(y.firstSelectedId.value)),b=v(()=>{const n=B.value.map(o=>o.name).map(o=>({value:o,label:o,icon:"function"})),t=D.value.map(o=>({label:`Go to page "${o}"`,value:`$goToPage_${o}`,icon:"link"})),e=I.value.map(o=>({label:`Run workflow "${o}"`,value:`$runWorkflow_${o}`,icon:"linked_services"}));return[{label:"(No handler)",value:"",icon:"block"},...n,...t,...e]});function M(n){var e;if(!j(n))return b.value;const t=(e=r.value.handlers)==null?void 0:e[n];return[...b.value,{value:t,label:`${t} (Not found)`}]}const O=v(()=>{const{type:n}=r.value,{events:t}=u.getComponentDefinition(n),e={...t};return Object.keys({...r.value.handlers}).forEach(o=>{e[o]||(e[o]={desc:"Custom event"})}),e}),B=u.userFunctions,D=v(()=>u.getComponents("root").filter(e=>e.type=="page").map(e=>e.content.key).filter(e=>!!e)),I=v(()=>u.getComponents("workflows_root").filter(e=>e.type=="workflows_workflow").map(e=>e.content.key).filter(e=>!!e)),j=n=>{var e;const t=(e=r.value.handlers)==null?void 0:e[n];return!(!t||t.startsWith("$")||B.value.some(o=>o.name==t))},T=(n,t)=>{S(r.value.id,t,n)},p=N(null),s=N(null);function U(){return`
# When dealing with a DOM event, Writer Framework generates a payload by serialising its
# primitive properties (non-Object, non-function properties).

# If the event is instead an instance of CustomEvent,
# it looks for a "payload" property inside the CustomEvent's "detail" property. 

def handle_keydown(state, payload):
	print(payload) # Shows all the properties captured

	key_activated = payload.get("key")
	if key_activated == "ArrowLeft":
		state["position"] += -10
	elif key_activated == "ArrowRight":
		state["position"] += 10

	`}function E(n){const{type:t}=r.value,{events:e}=u.getComponentDefinition(t),o=e==null?void 0:e[n];return o?o==null?void 0:o.stub:U()}async function z(n){const t=E(n),e=await Q.colorize(t.trim(),"python",{});p.value={modalTitle:`"${n}" event`,code:t,highlightedCodeHtml:e}}const L=["click","mousedown","mouseup","mouseenter","mouseleave","mousemove","keydown","keyup","keypress","input","change","submit","focus","blur","resize","scroll","load"];function P(){const{eventType:n,handlerFunctionName:t}=s.value;S(r.value.id,n,t),s.value=null}const R={desc:"Close",fn:()=>{p.value=null}};function q(){s.value={eventType:null,handlerFunctionName:null}}const G={desc:"Close",fn:()=>{s.value=null}},Y=n=>{navigator.clipboard.writeText(n)};return(n,t)=>{var o;const e=Z("dompurify-html");return ee(y).isSingleSelectionActive?(m(),_("div",re,[de,l("div",ue,[(m(!0),_($,null,A(O.value,(a,c)=>(m(),_("div",{key:c},[l("div",ce,[i(H,{label:c,hint:a==null?void 0:a.desc,"help-button":E(c)?"Show event handler stub":!1,onHelpClick:g=>z(c)},{default:d(()=>{var g;return[i(K,{"model-value":((g=r.value.handlers)==null?void 0:g[c])??"",options:M(c),"enable-search":"","onUpdate:modelValue":J=>T(J,c)},null,8,["model-value","options","onUpdate:modelValue"])]}),_:2},1032,["label","hint","help-button","onHelpClick"])])]))),128)),i(k,{variant:"tertiary",onClick:q},{default:d(()=>[pe,w("Add custom handler ")]),_:1})]),p.value?(m(),W(x,{key:0,"close-action":R,icon:"help","modal-title":(o=p.value)==null?void 0:o.modalTitle},{default:d(()=>[me,l("div",ve,[te(l("code",null,null,512),[[e,p.value.highlightedCodeHtml]])]),i(k,{variant:"tertiary",onClick:t[0]||(t[0]=a=>Y(p.value.code))},{default:d(()=>[fe,w(" Copy code to clipboard ")]),_:1})]),_:1},8,["modal-title"])):C("",!0),s.value?(m(),W(x,{key:1,"close-action":G,icon:"bolt","modal-title":"Add Custom Event Handler","allow-overflow":""},{default:d(()=>[l("div",he,[i(H,{label:"Event type",hint:"Can be any event type."},{default:d(()=>[i(oe,{modelValue:s.value.eventType,"onUpdate:modelValue":t[1]||(t[1]=a=>s.value.eventType=a),type:"text",list:"commonEventTypes"},null,8,["modelValue"]),l("datalist",_e,[(m(),_($,null,A(L,a=>l("option",{key:a,value:a},ne(a),9,ye)),64))])]),_:1}),i(H,{label:"Handler function",hint:"The function that will handle the event."},{default:d(()=>[i(K,{modelValue:s.value.handlerFunctionName,"onUpdate:modelValue":t[2]||(t[2]=a=>s.value.handlerFunctionName=a),options:b.value,"enable-search":""},null,8,["modelValue","options"])]),_:1})]),i(k,{variant:"tertiary",onClick:t[3]||(t[3]=a=>P())},{default:d(()=>[be,w("Add ")]),_:1})]),_:1})):C("",!0)])):C("",!0)}}}),Ve=ie(ge,[["__scopeId","data-v-b9d5b6a3"]]);export{Ve as default};
